###
#
# Run snapshot tests with percy
#
# This workflow only runs when triggered manually
#
###

name: Run snapshot tests
on: [pull_request]

jobs:
  snapshots:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup
        uses: swisspost/design-system/.github/actions/setup-pnpm@main

      - name: Bootstrap
        run: pnpm bootstrap

      - name: Install http-server
        run: pnpm -g add http-server

      - name: Take snapshots
        run: pnpm exec start-server-and-test 'http-server packages/documentation/storybook-static --silent --port 9300' 9300 'pnpm --filter "...[origin/main]" --workspace-concurrency=1 snapshots'
