name: Visual Regression Tests

on:
  pull_request:
    paths:
      - 'packages/components/**'
  push:
    branches:
      - main
    paths:
      - 'packages/components/**'
  workflow_dispatch:
    inputs:
      baseline-version:
        description: 'Baseline version (e.g., 1.2.3 or "latest")'
        type: string
        default: 'latest'
      force-update-baseline:
        description: 'Force create new baseline version'
        type: boolean
        default: false

permissions:
  contents: write
  actions: read
  pull-requests: write
  packages: write

jobs:
  visual-tests-components:
    name: Visual Tests - Components
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup
        uses: ./.github/actions/setup-pnpm

      - name: Install dependencies and build packages
        run: pnpm bootstrap

      - name: Cache Playwright browsers
        uses: actions/cache@v4
        with:
          path: ~/.cache/ms-playwright
          key: ${{ runner.os }}-playwright-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-playwright-

      - name: Install Playwright browsers
        working-directory: packages/components
        run: npx playwright install --with-deps chromium

      # ============================================
      # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–µ—Ä—Å–∏—é baseline –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
      # ============================================
      - name: Determine baseline version
        id: baseline-version
        working-directory: packages/components
        run: |
          if [ "${{ github.event.inputs.baseline-version }}" != "" ]; then
            # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π
            VERSION="${{ github.event.inputs.baseline-version }}"
          elif [ "${{ github.ref }}" == "refs/heads/main" ]; then
            # –ù–∞ main –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é latest –≤–µ—Ä—Å–∏—é
            VERSION="latest"
          else
            # –î–ª—è PR –∏—Å–ø–æ–ª—å–∑—É–µ–º latest –∏–∑ registry
            VERSION="latest"
          fi
          
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "üì¶ Using baseline version: $VERSION"

      # ============================================
      # –°–∫–∞—á–∏–≤–∞–µ–º baseline —Å–Ω–∏–º–∫–∏ –∏–∑ GitHub Packages
      # ============================================
      - name: Download baseline snapshots from registry
        id: download-baseline
        working-directory: packages/components
        continue-on-error: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º npm –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å GitHub Packages
          echo "@${{ github.repository_owner }}:registry=https://npm.pkg.github.com" > .npmrc
          echo "//npm.pkg.github.com/:_authToken=${{ secrets.GITHUB_TOKEN }}" >> .npmrc
          
          PACKAGE_NAME="@${{ github.repository_owner }}/$(basename ${{ github.repository }})-visual-baselines"
          VERSION="${{ steps.baseline-version.outputs.version }}"
          
          echo "üì• Attempting to download: $PACKAGE_NAME@$VERSION"
          
          # –ü—Ä–æ–±—É–µ–º —Å–∫–∞—á–∞—Ç—å –ø–∞–∫–µ—Ç
          if npm pack "$PACKAGE_NAME@$VERSION" 2>/dev/null; then
            TARBALL=$(ls *.tgz | head -1)
            echo "‚úÖ Downloaded: $TARBALL"
            
            # –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º —Å–Ω–∏–º–∫–∏
            tar -xzf "$TARBALL"
            mkdir -p visual-tests/__screenshots__
            
            if [ -d "package/screenshots" ]; then
              cp -r package/screenshots/* visual-tests/__screenshots__/
              SNAPSHOT_COUNT=$(find visual-tests/__screenshots__ -name "*.png" | wc -l)
              echo "üì∏ Extracted $SNAPSHOT_COUNT baseline snapshots"
              echo "baseline_exists=true" >> $GITHUB_OUTPUT
              echo "snapshot_count=$SNAPSHOT_COUNT" >> $GITHUB_OUTPUT
            else
              echo "‚ö†Ô∏è  No screenshots found in package"
              echo "baseline_exists=false" >> $GITHUB_OUTPUT
            fi
            
            # –û—á–∏—Å—Ç–∫–∞
            rm -rf package *.tgz .npmrc
          else
            echo "‚ö†Ô∏è  No baseline package found, will create new baselines"
            echo "baseline_exists=false" >> $GITHUB_OUTPUT
          fi

      # ============================================
      # –ü—Ä–æ–≤–µ—Ä—è–µ–º checkbox –≤ PR description
      # ============================================
      - name: Check PR description for VRT acknowledgment
        if: github.event_name == 'pull_request'
        id: check-vrt-checkbox
        uses: actions/github-script@v7
        with:
          script: |
            const { data: pr } = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number
            });
            
            const body = pr.body || '';
            
            // –ò—â–µ–º –æ—Ç–º–µ—á–µ–Ω–Ω—ã–π checkbox
            const hasCheckedBox = /- \[x\]\s*.*visual.*regression/i.test(body);
            
            core.setOutput('acknowledged', hasCheckedBox ? 'true' : 'false');
            
            if (hasCheckedBox) {
              console.log('‚úÖ Visual regression checkbox is checked');
            } else {
              console.log('‚ö†Ô∏è  Visual regression checkbox is NOT checked');
            }
            
            return hasCheckedBox;

      # ============================================
      # –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
      # ============================================
      - name: Run visual regression tests
        id: run-tests
        working-directory: packages/components
        continue-on-error: true
        run: |
          # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–≤–æ–¥
          pnpm test:visual 2>&1 | tee test-output.log
          EXIT_CODE=${PIPESTATUS[0]}
          
          echo "exit_code=$EXIT_CODE" >> $GITHUB_OUTPUT
          
          if [ $EXIT_CODE -eq 0 ]; then
            echo "‚úÖ All visual tests passed"
          else
            echo "‚ùå Visual tests failed"
          fi
          
          exit $EXIT_CODE

      # ============================================
      # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
      # ============================================
      - name: Analyze test failures
        id: analyze-failures
        if: always()
        working-directory: packages/components
        run: |
          if [ ! -f test-output.log ]; then
            echo "No test output found"
            echo "has_missing_baseline=false" >> $GITHUB_OUTPUT
            echo "has_visual_diff=false" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ baseline —Å–Ω–∏–º–∫–∏
          if grep -q "Error: A snapshot doesn't exist" test-output.log; then
            echo "has_missing_baseline=true" >> $GITHUB_OUTPUT
            MISSING_COUNT=$(grep -c "Error: A snapshot doesn't exist" test-output.log || echo "0")
            echo "missing_count=$MISSING_COUNT" >> $GITHUB_OUTPUT
            echo "‚ö†Ô∏è  Found $MISSING_COUNT missing baseline snapshots"
          else
            echo "has_missing_baseline=false" >> $GITHUB_OUTPUT
            echo "missing_count=0" >> $GITHUB_OUTPUT
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è
          if grep -q "pixels.*are different" test-output.log; then
            echo "has_visual_diff=true" >> $GITHUB_OUTPUT
            DIFF_COUNT=$(grep -c "pixels.*are different" test-output.log || echo "0")
            echo "diff_count=$DIFF_COUNT" >> $GITHUB_OUTPUT
            echo "üîç Found $DIFF_COUNT visual differences"
          else
            echo "has_visual_diff=false" >> $GITHUB_OUTPUT
            echo "diff_count=0" >> $GITHUB_OUTPUT
          fi

      # ============================================
      # –ü—Ä–∏–Ω–∏–º–∞–µ–º —Ä–µ—à–µ–Ω–∏–µ: fail –∏–ª–∏ pass –¥–ª—è PR
      # ============================================
      - name: Evaluate test result for PR
        if: github.event_name == 'pull_request'
        run: |
          EXIT_CODE="${{ steps.run-tests.outputs.exit_code }}"
          HAS_MISSING="${{ steps.analyze-failures.outputs.has_missing_baseline }}"
          HAS_DIFF="${{ steps.analyze-failures.outputs.has_visual_diff }}"
          ACKNOWLEDGED="${{ steps.check-vrt-checkbox.outputs.acknowledged }}"
          
          echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
          echo "üìä Test Result Analysis:"
          echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
          echo "Exit Code: $EXIT_CODE"
          echo "Missing Baselines: $HAS_MISSING (${{ steps.analyze-failures.outputs.missing_count }})"
          echo "Visual Differences: $HAS_DIFF (${{ steps.analyze-failures.outputs.diff_count }})"
          echo "Checkbox Checked: $ACKNOWLEDGED"
          echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
          
          # –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è - –≤—Å–µ–≥–¥–∞ fail
          if [ "$HAS_DIFF" == "true" ]; then
            echo ""
            echo "‚ùå FAILED: Visual differences detected!"
            echo ""
            echo "Action required:"
            echo "1. Download the 'visual-diffs' artifact from this workflow run"
            echo "2. Review the *-diff.png files to see what changed"
            echo "3. If changes are intentional:"
            echo "   - Check the '‚òëÔ∏è Checked for visual regressions' checkbox in PR description"
            echo "   - Re-run the workflow"
            echo "4. If changes are bugs, fix them and push new commits"
            echo ""
            exit 1
          fi
          
          # –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (missing baseline)
          if [ "$HAS_MISSING" == "true" ]; then
            if [ "$ACKNOWLEDGED" == "true" ]; then
              echo ""
              echo "‚úÖ PASSED: New visual snapshots detected and acknowledged"
              echo ""
              echo "‚ÑπÔ∏è  New baseline snapshots will be created when this PR is merged to main"
              echo ""
              exit 0
            else
              echo ""
              echo "‚ö†Ô∏è  FAILED: New visual snapshots detected but NOT acknowledged"
              echo ""
              echo "Action required:"
              echo "1. This PR introduces ${{ steps.analyze-failures.outputs.missing_count }} new component(s) or state(s)"
              echo "2. Download the 'playwright-report' artifact to review the new snapshots"
              echo "3. If these new snapshots are expected:"
              echo "   - Check the '‚òëÔ∏è Checked for visual regressions' checkbox in PR description"
              echo "   - Re-run the workflow"
              echo ""
              exit 1
            fi
          fi
          
          # –í—Å–µ –ø—Ä–æ—à–ª–æ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
          if [ "$EXIT_CODE" == "0" ]; then
            echo ""
            echo "‚úÖ PASSED: No visual changes detected"
            echo ""
            exit 0
          fi
          
          # –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞
          echo ""
          echo "‚ùå FAILED: Unexpected test failure"
          echo ""
          exit 1

      # ============================================
      # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ baseline –ø—Ä–∏ –º–µ—Ä–∂–µ –≤ main
      # ============================================
      - name: Create new baseline snapshots
        if: |
          (github.ref == 'refs/heads/main' && github.event_name == 'push') ||
          github.event.inputs.force-update-baseline == 'true'
        working-directory: packages/components
        run: |
          echo "üé® Generating new baseline snapshots..."
          pnpm test:visual:update
          
          SNAPSHOT_COUNT=$(find visual-tests/__screenshots__ -name "*.png" | wc -l)
          echo "üì∏ Generated $SNAPSHOT_COUNT baseline snapshots"

      - name: Optimize baseline PNG files
        if: |
          (github.ref == 'refs/heads/main' && github.event_name == 'push') ||
          github.event.inputs.force-update-baseline == 'true'
        run: |
          echo "üóúÔ∏è  Optimizing PNG files..."
          sudo apt-get update
          sudo apt-get install -y pngquant
          
          find packages/components/visual-tests/__screenshots__ -name "*.png" \
            -exec pngquant --force --ext .png --quality 80-95 --skip-if-larger {} \;
          
          echo "‚úÖ PNG optimization complete"

      # ============================================
      # –ü—É–±–ª–∏–∫—É–µ–º baseline –≤ GitHub Packages
      # ============================================
      - name: Get package version
        if: |
          (github.ref == 'refs/heads/main' && github.event_name == 'push') ||
          github.event.inputs.force-update-baseline == 'true'
        id: package-version
        working-directory: packages/components
        run: |
          # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Ä—Å–∏—é –∏–∑ package.json
          VERSION=$(node -p "require('./package.json').version")
          
          # –î–æ–±–∞–≤–ª—è–µ–º timestamp –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
          TIMESTAMP=$(date +%Y%m%d%H%M%S)
          BASELINE_VERSION="${VERSION}-baseline.${TIMESTAMP}"
          
          echo "version=$BASELINE_VERSION" >> $GITHUB_OUTPUT
          echo "üì¶ Baseline package version: $BASELINE_VERSION"

      - name: Create baseline package
        if: |
          (github.ref == 'refs/heads/main' && github.event_name == 'push') ||
          github.event.inputs.force-update-baseline == 'true'
        working-directory: packages/components
        run: |
          echo "üì¶ Creating baseline package..."
          
          # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø–∞–∫–µ—Ç–∞
          mkdir -p baseline-package/screenshots
          
          # –ö–æ–ø–∏—Ä—É–µ–º —Å–Ω–∏–º–∫–∏
          cp -r visual-tests/__screenshots__/* baseline-package/screenshots/
          
          # –°–æ–∑–¥–∞–µ–º package.json
          REPO_NAME=$(basename ${{ github.repository }})
          PACKAGE_NAME="@${{ github.repository_owner }}/${REPO_NAME}-visual-baselines"
          VERSION="${{ steps.package-version.outputs.version }}"
          
          cat > baseline-package/package.json <<EOF
          {
            "name": "${PACKAGE_NAME}",
            "version": "${VERSION}",
            "description": "Visual regression baseline snapshots for ${REPO_NAME}",
            "repository": {
              "type": "git",
              "url": "git+https://github.com/${{ github.repository }}.git"
            },
            "files": [
              "screenshots/**/*.png"
            ],
            "publishConfig": {
              "registry": "https://npm.pkg.github.com"
            }
          }
          EOF
          
          echo "‚úÖ Baseline package created"
          cat baseline-package/package.json

      - name: Publish baseline package to GitHub Packages
        if: |
          (github.ref == 'refs/heads/main' && github.event_name == 'push') ||
          github.event.inputs.force-update-baseline == 'true'
        working-directory: packages/components/baseline-package
        env:
          NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "üì§ Publishing baseline package..."
          
          # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º npm –¥–ª—è GitHub Packages
          echo "@${{ github.repository_owner }}:registry=https://npm.pkg.github.com" > .npmrc
          echo "//npm.pkg.github.com/:_authToken=${NODE_AUTH_TOKEN}" >> .npmrc
          
          # –ü—É–±–ª–∏–∫—É–µ–º –ø–∞–∫–µ—Ç
          npm publish
          
          PACKAGE_NAME=$(node -p "require('./package.json').name")
          VERSION=$(node -p "require('./package.json').version")
          
          echo "‚úÖ Published: ${PACKAGE_NAME}@${VERSION}"
          echo ""
          echo "üîó Package URL: https://github.com/${{ github.repository }}/packages"

      # ============================================
      # Upload artifacts –ø—Ä–∏ failures
      # ============================================
      - name: Upload Playwright report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: packages/components/playwright-report
          retention-days: 14

      - name: Upload test results
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: test-results
          path: packages/components/test-results
          retention-days: 14

      - name: Upload visual diff screenshots
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: visual-diffs
          path: |
            packages/components/test-results/**/*-diff.png
            packages/components/test-results/**/*-actual.png
            packages/components/test-results/**/*-expected.png
          retention-days: 14

      # ============================================
      # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ PR —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
      # ============================================
      - name: Comment on PR with test results
        if: always() && github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const path = require('path');
            
            const exitCode = '${{ steps.run-tests.outputs.exit_code }}';
            const hasMissing = '${{ steps.analyze-failures.outputs.has_missing_baseline }}' === 'true';
            const hasDiff = '${{ steps.analyze-failures.outputs.has_visual_diff }}' === 'true';
            const missingCount = '${{ steps.analyze-failures.outputs.missing_count }}' || '0';
            const diffCount = '${{ steps.analyze-failures.outputs.diff_count }}' || '0';
            const acknowledged = '${{ steps.check-vrt-checkbox.outputs.acknowledged }}' === 'true';
            const baselineExists = '${{ steps.download-baseline.outputs.baseline_exists }}' === 'true';
            const snapshotCount = '${{ steps.download-baseline.outputs.snapshot_count }}' || '0';
            
            let comment = '## üîç Visual Regression Test Results\n\n';
            
            // –°—Ç–∞—Ç—É—Å baseline
            comment += '### üì¶ Baseline Status\n\n';
            if (baselineExists) {
              comment += `‚úÖ Using baseline with ${snapshotCount} snapshots\n\n`;
            } else {
              comment += `‚ö†Ô∏è No baseline found - will create new baseline on merge\n\n`;
            }
            
            // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
            comment += '### üìä Test Results\n\n';
            
            if (exitCode === '0') {
              comment += '‚úÖ **All tests passed** - No visual changes detected\n\n';
            } else {
              if (hasDiff) {
                comment += `‚ùå **Visual differences detected** (${diffCount} test(s) failed)\n\n`;
                comment += '**Action Required:**\n';
                comment += '1. Download the `visual-diffs` artifact from this workflow run\n';
                comment += '2. Review the comparison images:\n';
                comment += '   - `*-diff.png` - highlighted differences\n';
                comment += '   - `*-actual.png` - current screenshot\n';
                comment += '   - `*-expected.png` - baseline screenshot\n';
                comment += '3. If changes are **intentional**:\n';
                comment += '   - Check the ‚òëÔ∏è "Checked for visual regressions" checkbox in the PR description\n';
                comment += '   - Re-run this workflow\n';
                comment += '4. If changes are **bugs**, fix them and push new commits\n\n';
              }
              
              if (hasMissing) {
                comment += `‚ö†Ô∏è **New component snapshots** (${missingCount} new snapshot(s))\n\n`;
                
                if (acknowledged) {
                  comment += '‚úÖ New snapshots acknowledged - will be created on merge\n\n';
                } else {
                  comment += '**Action Required:**\n';
                  comment += '1. Download the `playwright-report` artifact to review new snapshots\n';
                  comment += '2. Verify that new components render correctly\n';
                  comment += '3. Check the ‚òëÔ∏è "Checked for visual regressions" checkbox in PR description\n';
                  comment += '4. Re-run this workflow\n\n';
                }
              }
            }
            
            // –°—Å—ã–ª–∫–∏ –Ω–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
            comment += '### üìé Artifacts\n\n';
            comment += `- [Playwright HTML Report](${context.payload.repository.html_url}/actions/runs/${context.runId})\n`;
            if (exitCode !== '0') {
              comment += `- [Visual Diffs](${context.payload.repository.html_url}/actions/runs/${context.runId}#artifacts)\n`;
            }
            
            // –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            const { data: comments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number
            });
            
            const botComment = comments.find(comment => 
              comment.user.type === 'Bot' && 
              comment.body.includes('üîç Visual Regression Test Results')
            );
            
            if (botComment) {
              // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
              await github.rest.issues.updateComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                comment_id: botComment.id,
                body: comment
              });
            } else {
              // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: comment
              });
            }