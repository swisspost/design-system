@use '@swisspost/design-system-styles/mixins/button' as button-mx;
@use '@swisspost/design-system-styles/mixins/icons' as icon-mx;
@use '@swisspost/design-system-styles/mixins/utilities' as utility-mx;

@use '@swisspost/design-system-styles/tokens/components';
@use '@swisspost/design-system-styles/tokens/elements';
@use '@swisspost/design-system-styles/tokens/helpers';
@use '@swisspost/design-system-styles/functions/tokens';
@use '@swisspost/design-system-styles/variables/components/accordion';

tokens.$default-map: components.$post-accordion;

:host {
  display: block;
  border-block-end: tokens.get('accordion-border-bottom-width')
    tokens.get('accordion-border-bottom-style') tokens.get('accordion-enabled-border');

  &:has(.accordion-button:hover) {
    border-block-end-color: tokens.get('accordion-hover-border');

    @include utility-mx.high-contrast-mode() {
      border-block-end-color: Highlight;
    }
  }
}

.accordion-header {
  color: tokens.get('accordion-enabled-fg');
  font-size: tokens.get('accordion-header-font-size');
  margin: 0;
  line-height: tokens.get('heading-line-height', elements.$post-heading);
  font-weight: tokens.get('heading-font-weight', elements.$post-heading);
}

.accordion-button {
  @include button-mx.reset-button;
  display: flex;
  position: relative;
  width: 100%;
  align-items: center;
  text-align: start;
  gap: tokens.get('accordion-header-content-gap-inline');
  padding-block: tokens.get('accordion-header-padding-block-open');
  padding-inline: tokens.get('accordion-header-padding-inline');
  border-block-end: tokens.get('accordion-border-bottom-width')
    tokens.get('accordion-border-bottom-style') transparent;
  cursor: pointer;
  @include utility-mx.focus-style-none;

  @include utility-mx.focus-style('::before') {
    display: block;
    content: '';
    position: absolute;
    inset: calc(tokens.get('accordion-group-border-top-width') * -1) 0
      calc(tokens.get('accordion-border-bottom-width') * -1);
    border-radius: tokens.get('focus-border-radius', helpers.$post-focus);
  }

  slot::slotted(span[slot='header']) {
    flex-grow: 1;
  }

  post-icon {
    flex: none;
    width: tokens.get('accordion-icon-size');
    aspect-ratio: 1;
    transition: accordion.$accordion-icon-transition;
  }

  &.collapsed {
    padding-block-start: tokens.get('accordion-header-padding-block-closed');
    padding-block-end: tokens.get('accordion-header-padding-block-closed');

    post-icon {
      transform: accordion.$accordion-icon-transform;
    }
  }

  &:hover {
    color: tokens.get('accordion-hover-fg');
  }

  > ::slotted(.text-truncate) {
    display: block;
  }

  @include utility-mx.high-contrast-mode() {
    &:hover,
    &:focus-visible {
      color: Highlight;
    }
  }
}

post-collapsible {
  margin-block-end: calc(tokens.get('accordion-border-bottom-width') * -1);
}

.accordion-body {
  padding-block-start: tokens.get('accordion-content-padding-block-start');
  padding-block-end: tokens.get('accordion-content-padding-block-end');
  padding-inline: tokens.get('accordion-content-padding-inline');
}

.logo-container {
  display: none;

  width: tokens.get('accordion-header-logo-size');
  aspect-ratio: 1;

  &.has-image {
    display: block;
  }

  slot::slotted(img) {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
}

.accordion-button,
.accordion-body {
  > ::slotted(:first-child) {
    margin-block-start: 0 !important;
  }

  > ::slotted(:last-child) {
    margin-block-end: 0 !important;
  }
}
