@use 'sass:map';
@use 'sass:meta';

@use '../functions/string';
@use '../functions/tokens';
@use '../tokens/components';
@use '../tokens/theme';
@use '../tokens/scheme';
@use '../tokens/temp/core';

/**
 * This function aims to retrieve a token value from the core tokens.
 * It's usage is temporary, we must remove it as soon as the CSS light-dark() function is better supported.
 */

@function value($key, $theme: 'post', $scheme: 'light') {
  $normalized-key: tokens.normalize-key($key);
  $value: map.get(components.$post-accent, $normalized-key);

  $semantic-key: string.replace($value, 'var(--', '');
  $semantic-key: string.replace($semantic-key, ')', '');

  $theme-map: map.get(meta.module-variables(theme), 'post-#{$theme}');
  $scheme-map: map.get(meta.module-variables(scheme), 'post-#{$scheme}');
  $semantic-value: if(
      map.has-key($theme-map, $semantic-key),
      map.get($theme-map, $semantic-key),
      map.get($scheme-map, $semantic-key)
  );

  $core-key: string.replace($semantic-value, 'var(--', '');
  $core-key: string.replace($core-key, ')', '');

  $core-value: map.get(core.$post-core, $core-key);

  @return $core-value;
}
