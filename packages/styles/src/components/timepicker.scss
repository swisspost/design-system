@forward './../variables/options';

@use 'sass:map';

@use './../mixins/utilities';
@use './../mixins/icons' as icon-mixins;
@use './../mixins/forms' as form-mixins;
@use './../mixins/button' as button-mixins;
@use './../variables/type';
@use './../variables/spacing';

@use './../variables/color';
@use './../variables/components/forms';
@use './../variables/components/button';

$tp-icon-sm: spacing.$size-regular !default;
$tp-icon-rg: 1.125rem !default;
$tp-icon-md: spacing.$size-small-large !default;
$tp-icon-lg: 1.375rem !default;

$tp-icon-map: (
  'sm': $tp-icon-sm,
  'rg': $tp-icon-rg,
  'md': $tp-icon-md,
  'lg': $tp-icon-lg,
);

// Basic timepicker overrides
.ngb-tp {
  .ngb-tp-input-container {
    width: auto;
  }

  .form-control {
    width: 4.5rem;
  }

  .form-control-sm,
  .form-control-rg {
    width: 4rem;
  }

  .form-control-lg {
    width: 6rem;
    padding: 1rem 1.375rem;
    @include form-mixins.placeholder {
      color: forms.$input-placeholder-color;
    }
  }

  .ngb-tp-chevron {
    &::before {
      @include icon-mixins.icon('2051');
      width: map.get($tp-icon-map, 'md');
      height: map.get($tp-icon-map, 'md');
      transform: none;
    }

    &.bottom::before {
      transform: rotateZ(180deg);
    }
  }

  @each $size in sm, lg {
    .btn-#{$size} .ngb-tp-chevron::before {
      width: map.get($tp-icon-map, $size);
      height: map.get($tp-icon-map, $size);
    }
  }

  @include utilities.high-contrast-mode() {
    .form-control {
      &:hover,
      &:focus-visible {
        border-color: Highlight;
      }
    }
  }
}

// Regular-sized timepicker
.timepicker-rg {
  .btn {
    min-height: map.get(button.$btn-height-map, 'rg');
    font-size: type.$font-size-16;
    gap: map.get(button.$btn-gap-x-map, 'rg');

    &:where(:not(.btn-link, .btn-tertiary)) {
      padding: 0 map.get(button.$btn-padding-x-map, 'rg');
    }

    > .pi,
    > post-icon {
      width: map.get($tp-icon-map, 'rg');
      height: map.get($tp-icon-map, 'rg');
    }

    .ngb-tp-chevron::before {
      width: map.get($tp-icon-map, 'rg');
      height: map.get($tp-icon-map, 'rg');
    }
  }

  .form-control {
    @include form-mixins.form-rg;
  }
}

// Timepicker validation
ngb-timepicker {
  &.ng-invalid {
    .form-control {
      border-color: color.$error;

      &:focus {
        border-color: color.$error;
        box-shadow: 0 0 0 forms.$input-focus-width rgba(color.$error, 0.25);
      }
    }

    ~ .invalid-feedback,
    ~ .invalid-tooltip {
      display: block;
    }
  }

  &.ng-valid {
    ~ .valid-feedback,
    ~ .valid-tooltip {
      display: block;
    }
  }

  @include utilities.high-contrast-mode() {
    &.ng-invalid,
    &.ng-valid {
      .form-control {
        &:hover,
        &:focus-visible {
          border-color: Highlight;
        }
      }
    }
  }
}
