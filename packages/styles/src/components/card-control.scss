@use '../variables/components/form-check';
@use '../mixins/forms' as forms-mx;
@use '../mixins/utilities' as utility-mx;
@use '../functions/tokens';
@use '../tokens/components';
@use '../tokens/utilities';

tokens.$default-map: components.$post-card-control;

/*
* There are a whole bunch of !important statments in this file.
* They are necessary and should not be removed, because we need to override the .form-check styles here.
*/
fieldset {
  .card-control {
    &:not(:last-child) {
      margin-bottom: tokens.get('utility-gap-16', utilities.$post-spacing);
    }
  }
}

.card-control {
  --post-card-control-scheme: #{tokens.get('card-control-unselected-scheme')};
  --post-card-control-padding: 1rem;
  --post-card-control-bg: #{tokens.get('card-control-unselected-bg')};
  --post-card-control-border-width: 2px;
  --post-card-control-border-style: solid;
  --post-card-control-border-color: #{tokens.get('card-control-unselected-stroke')};
  --post-card-control-border-radius: 8px;
  --post-card-control-column-gap: 1rem;
  --post-card-control-color: #{tokens.get('card-control-unselected-fg')};

  --post-card-control-input-margin-block: 4px;

  --post-card-control-padding-block: 1px;
  --post-card-control-label-font-weight: 700;

  --post-card-control-icon-size: 32px;

  --post-card-control-description-font-size: 1rem;

  // --------------------------------------------------

  display: grid;
  grid-template-areas: 'input label icon';
  grid-template-columns: min-content auto min-content;
  column-gap: var(--post-card-control-column-gap);
  align-items: start;
  padding: var(--post-card-control-padding);
  background-color: var(--post-card-control-bg);
  border-width: var(--post-card-control-border-width);
  border-style: var(--post-card-control-border-style);
  border-color: var(--post-card-control-border-color);
  border-radius: var(--post-card-control-border-radius);
  color: var(--post-card-control-color);
  cursor: pointer;

  @include utility-mx.focus-style();

  &:hover,
  &.pretend-hover {
    --post-card-control-border-color: #{tokens.get('card-control-unselected-hovered-stroke')};
    --post-card-control-color: #{tokens.get('card-control-unselected-hovered-fg')};
  }

  &:has(input:disabled) {
    --post-card-control-border-style: dashed;
    --post-card-control-border-color: #{tokens.get('card-control-unselected-disabled-stroke')};
    --post-card-control-color: #{tokens.get('card-control-unselected-disabled-fg')};
    cursor: default;
  }

  &:has(input:checked) {
    --post-card-control-scheme: #{tokens.get('card-control-selected-scheme')};
    --post-card-control-bg: #{tokens.get('card-control-selected-bg')};
    --post-card-control-border-color: #{tokens.get('card-control-selected-stroke')};
    --post-card-control-color: #{tokens.get('card-control-selected-fg')};

    &:hover,
    // TODO: remove the following selector for prod
    &.pretend-hover {
      --post-card-control-border-color: #{tokens.get('card-control-selected-hovered-stroke')};
      --post-card-control-color: #{tokens.get('card-control-selected-hovered-fg')};
    }

    &:has(input:disabled) {
      --post-card-control-border-style: dashed;
      --post-card-control-border-color: #{tokens.get('card-control-selected-disabled-stroke')};
      --post-card-control-color: #{tokens.get('card-control-selected-disabled-fg')};
    }
  }

  > * {
    // WARNING: keeping the color-scheme on all child elements, prevents the focus-outline from having the wrong color in some color combinations.
    color-scheme: var(--post-card-control-scheme);
    display: block;
    // every non-standard content is located on: row 2, column 'label' & 'icon'
    grid-area: 2 / label / 2 / icon;
  }

  &:has(> .card-control--description) > * {
    // if description is present, every non-standard content is located on: row 3, column 'label' & 'icon'
    grid-area: 3 / label / 3 / icon;
  }

  > input {
    grid-area: input !important;
    margin: var(--post-card-control-input-margin-block) 0 !important;
    outline: 0 none !important;
    // TODO: keep that during development and decide at the end if it can stay
    border-color: var(--post-card-control-color) !important;
    transition: none !important;

    &:checked::after {
      background-color: var(--post-card-control-color) !important;
    }

    &[type='checkbox'] {
      @include forms-mx.checkbox($omitHover: true);
    }
  }

  > .card-control--label {
    grid-area: label;
    padding-block: var(--post-card-control-padding-block);
    font-weight: var(--post-card-control-label-font-weight);
  }

  > .card-control--icon {
    grid-area: icon;
    font-size: var(--post-card-control-icon-size);
    line-height: 1;
  }

  > .card-control--description {
    grid-area: 2 / label / 2 / icon;
    align-items: start;
    font-size: var(--post-card-control-description-font-size);
  }
}
