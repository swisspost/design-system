import { Meta, Canvas, Controls, Source } from '@storybook/addon-docs/blocks';
import * as CCR from './aria-describedby.stories';
import DefaultExample from './examples/defaultExample.sample.html?raw';
import DefaultExample2 from './examples/defaultExample2.sample.html?raw';
import AriaDescribedbyElementsPropertyHTML from './examples/ariadescribedbyElementsProperty.sample.html?raw';
import AriaDescribedbyElementsProperty from './examples/ariadescribedbyElementsProperty.sample.js?raw';
import NonWorkingExampleIIa from './examples/nonWorkingExample-IIa.sample.html?raw';
import NonWorkingExampleIIb from './examples/nonWorkingExample-IIb.sample.html?raw';
import WorkingExampleIIa from './examples/workingExample-IIa.sample.html?raw';
import WorkingExampleIIb from './examples/workingExample-IIb.sample.html?raw';
import NonWorkingExampleIII from './examples/nonWorkingExample-III.sample.html?raw';
import WorkingExampleIII from './examples/workingExample-III.sample.html?raw';
import NonWorkingExampleIV from './examples/nonWorkingExample-IV.sample.html?raw';
import WorkingExampleIV from './examples/workingExample-IV.sample.html?raw';

<Meta of={CCR} />

# aria-describedby

<div className="lead">
  In the Light DOM, `aria-describedby` is used to give an element a description by referencing the
  ID of another element or multiple elements that contain the desired text.
</div>
<p>
  This is useful when a simple text label isn't enough or when the description needs to be combined
  from different pieces of text.
</p>

### I. Referencing Within the Same DOM Tree

‚Ä¢ <b>Both elements in Light DOM</b> ‚úîÔ∏è

<Source language="html" dark code={DefaultExample}></Source>

‚Ä¢ <b>Both elements in same Shadow DOM</b> ‚úîÔ∏è

<Source language="html" dark code={DefaultExample2}></Source>
<p>
  <b>
    The above relationships are valid because in both cases the target element and its description
    are part of the same tree.
  </b>
</p>

<p>
  Below is a working example of an `aria-describedby`/`id` relationship within the shadowDom of a
  custom button component. You can <b>test it with NVDA</b> to confirm the correct description
  announcement.
</p>
<Canvas of={CCR.ExampleHTML} sourceState="hide" />


### II. Referencing From Outside a Shadow DOM Into That Shadow DOM

‚Ä¢ <b>Light DOM ‚Üí Shadow DOM</b> ‚ùå

<Source language="html" dark code={NonWorkingExampleIIa}></Source>

‚Ä¢ <b>Slotted Content ‚Üí Shadow DOM</b> ‚ùå

<Source language="html" dark code={NonWorkingExampleIIb}></Source>

<p>
  The above examples do not work across shadow DOM boundaries when setting the aria-describedby
  attribute directly.
</p>
<p>
  <b>
    Attribute element references can only point to elements in the same DOM or shadow DOM, because
    IDs are only valid within their own scope.
  </b>
</p>

#### Workaround: `Element:ariaDescribedByElements`

<p>
  `ariaDescribedByElements` is a property of the Element interface that returns an array of elements
  describing the element. It provides direct references to these elements rather than just their ID
  strings.
  <a
    target="blank"
    href="https://developer.mozilla.org/en-US/docs/Web/API/Element/ariaDescribedByElements"
  >
    üîóariaDescribedByElements
  </a>
</p>

<div className="lead">Basic usage of `ariaDescribedByElements` </div>
<Source language="html" dark code={AriaDescribedbyElementsPropertyHTML}></Source>
<p>
  Instead of adding the `aria-describedby` attribute on the element, we can set it using the
  `ariaDescribedByElements` property.
</p>
<Source language="js" dark code={AriaDescribedbyElementsProperty}></Source>
<p>
  The following examples demonstrate how the `ariaDescribedByElements` property can be used to
  establish relationships <b>across the shadow DOM</b>.
</p>

<p>
  <b>‚Ä¢ Light DOM ‚Üí Shadow DOM Example</b> ‚úîÔ∏è
</p>
<p>
  In this case a description element in the light DOM is directly assigned to a target element inside a
  custom component‚Äôs shadow DOM using `ariaDescribedByElements`.
</p>

<Source language="html" dark code={WorkingExampleIIa}></Source>
<p>Use the control below to toggle the `ariaDescribedByElements` workaround implementation.</p>
<Canvas of={CCR.Example2} sourceState="hide" />
<div className="hide-col-default">
  <Controls of={CCR.Example2} />
</div>

<p>
  <b>‚Ä¢ Slotted Content ‚Üí Shadow DOM Example</b> ‚úîÔ∏è
</p>
<p>
  In this case a description element provided via a light DOM slot is automatically assigned to a target
  element inside a custom component‚Äôs shadow DOM using `ariaDescribedByElements`.
</p>
<Source language="html" dark code={WorkingExampleIIb}></Source>
<p>Use the control below to toggle the `ariaDescribedByElements` workaround implementation.</p>
<Canvas of={CCR.Example3} sourceState="hide<p>" />
<div className="hide-col-default">
  <Controls of={CCR.Example3} />
</div>

‚ö†Ô∏è In the above scenarios, the relationship is correctly announced by NVDA, passes accessibility checks on Axe, WAVE and NVDA but partially fails on Siteimprove and Accessibility Insights tools.

### III. Referencing From Inside a Shadow DOM Out to the Light DOM

<p>
  <b>‚Ä¢ Shadow DOM ‚Üí Light DOM (or Shadow DOM ‚Üí Slotted Content)</b>‚ùå
</p>

<p>
  Referencing an element in the light DOM from within a shadow DOM using the standard
  `aria-describedby` is not possible. The `ariaDescribedByElements` property neither works in this
  case because, for it to work, the description element must be in the same DOM or in a parent DOM of the
  target element.
</p>
<Source language="html" dark code={NonWorkingExampleIII}></Source>

##### Working Solution: Set the `id`on the description component host

<p>
  The only option here is to <b>set the `id` directly on the host</b> of the description component. In
  this case <b>all the visible text inside this component will be assigned as the Accessible Description</b>  of the target element.
</p>
<Source language="html" dark code={WorkingExampleIII}></Source>
<Canvas of={CCR.Example4} sourceState="hide" />

### IV. Referencing From One Shadow DOM To Another Shadow DOM

Shadow DOM ‚Üí Other Shadow DOM ‚ùå

<Source language="html" dark code={NonWorkingExampleIV}></Source>
<p>
  This relationship is not valid because both `id` and `aria-describedby` attributes are scoped only within
  their individual shadowDoms.
</p>

##### Working Solution

A working solution for this case combines approaches II and III: setting the description component‚Äôs `id` directly on the host element (III), and using `Element.ariaDescribedByElements` to assign the description to the target component.

<Source language="html" dark code={WorkingExampleIV}></Source>
<Canvas of={CCR.Example5} sourceState="shown" />

‚ö†Ô∏è In the above scenario, the relationship is correctly announced by NVDA, passes accessibility checks on Axe, WAVE and NVDA but partially fails on Siteimprove and Accessibility Insights tools.
