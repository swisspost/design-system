import { Meta, Canvas, Controls, Source } from '@storybook/addon-docs/blocks';
import * as CCR from './for.stories';
import DefaultExample from './examples/default-example.sample.html?raw';
import DefaultExample2 from './examples/default-example-2.sample.html?raw';
import ArialabelledbyElementsPropertyHTML from './examples/arialabelledbyelements-property.sample.html?raw';
import ArialabelledbyElementsProperty from './examples/arialabelledbyelements-property.sample.js?raw';
import NonWorkingExampleIIa from './examples/non-working-example-IIa.sample.html?raw';
import NonWorkingExampleIIb from './examples/non-working-example-IIb.sample.html?raw';
import WorkingExampleIIa from './examples/working-example-IIa.sample.html?raw';
import WorkingExampleIIb from './examples/working-example-IIb.sample.html?raw';
import NonWorkingExampleIII from './examples/non-working-example-III.sample.html?raw';
import WorkingExampleIII from './examples/working-example-III.sample.html?raw';
import NonWorkingExampleIV from './examples/non-working-example-IV.sample.html?raw';
import WorkingExampleIV from './examples/working-example-IV.sample.html?raw';

<Meta of={CCR} />

# for

##

<div className="lead">The native HTML `for`/`id` relationship is a fundamental way to connect a `<label>` element to a form control, such as `<input>`, `<select>`, `<textarea>`, etc. or even to a custom form-associated control within the same DOM.</div>

<p>
  This relationship is important for accessibility, as it allows assistive technologies to correctly
  associate and announce the label text when focus is placed on the respective input field.
</p>

### I. Referencing Within the Same DOM Tree

‚Ä¢ <b>Both elements in Light DOM</b> ‚úîÔ∏è

<Source language="html" dark code={DefaultExample}></Source>

‚Ä¢ <b>Both elements in same Shadow DOM</b> ‚úîÔ∏è

<Source language="html" dark code={DefaultExample2}></Source>
<p>
  <b>
    The above relationships are valid because in both cases the label and its associated input
    element are part of the same tree.
  </b>
</p>

<p>
  Below is a working example of a `for`/`id` relationship within the shadowDom of a custom
  component. You can <b>test it with NVDA</b> to confirm the correct label announcement.
</p>

<Canvas of={CCR.ExampleHTML} sourceState="hide" />
### II. Referencing From the Light DOM into the ShadowDOM

‚Ä¢ <b>Light DOM ‚Üí Shadow DOM</b> ‚ùå

<Source language="html" dark code={NonWorkingExampleIIa}></Source>

‚Ä¢ <b>Slotted Content ‚Üí Shadow DOM</b> ‚ùå

<Source language="html" dark code={NonWorkingExampleIIb}></Source>

<p>
  The above examples do not work across shadow DOM boundaries when setting the `for` / `id`
  attributes directly.
</p>
<p>
  <b>
    Attribute element references can only point to elements in the same DOM or shadow DOM, because
    IDs are only valid within their own scope.
  </b>
</p>

#### Workaround: `Element:ariaLabelledByElements`

<p>
  `ariaLabelledByElements` is a property of the <a href="https://developer.mozilla.org/fr/docs/Web/API/Element" target="_blank">Element API</a> that returns an array of elements
  labeling the element. It provides direct references to these elements rather than just their ID
  strings.
  <a
    target="blank"
    href="https://developer.mozilla.org/en-US/docs/Web/API/Element/ariaLabelledByElements"
  >
    üîóariaLabelledByElements
  </a>
</p>

<div className="lead">Basic usage of `ariaLabelledByElements` </div>

<p>
  Instead of adding the `aria-labelledby` attribute on the element, we can set it using the
  `ariaLabelledByElements` property.
</p>
<Source language="html" dark code={ArialabelledbyElementsPropertyHTML}></Source>

<Source language="js" dark code={ArialabelledbyElementsProperty}></Source>
<p>
  The following examples demonstrate how the `ariaLabelledByElements` property can be used to
  establish relationships <b>across the shadow DOM</b>.
</p>

<p>
  <b>‚Ä¢ Light DOM ‚Üí Shadow DOM Example</b> ‚úîÔ∏è
</p>
<p>
  In this case a label element in the light DOM is directly assigned to a target element inside a
  custom component‚Äôs shadow DOM using `ariaLabelledByElements`.
</p>

<Source language="html" dark code={WorkingExampleIIa}></Source>
<p>Use the control below to toggle the `ariaLabelledByElements` workaround implementation.</p>
<Canvas of={CCR.Example2} sourceState="hide" />
<div className="hide-col-default">
  <Controls of={CCR.Example2} />
</div>

<p>
  <b>‚Ä¢ Slotted Content ‚Üí Shadow DOM Example</b> ‚úîÔ∏è
</p>
<p>
  In this case a label element provided via a light DOM slot is automatically assigned to a target
  element inside a custom component‚Äôs shadow DOM using `ariaLabelledByElements`.
</p>
<Source language="html" dark code={WorkingExampleIIb}></Source>
<p>Use the control below to toggle the `ariaLabelledByElements` workaround implementation.</p>
<Canvas of={CCR.Example3} sourceState="hide<p>" />
<div className="hide-col-default">
  <Controls of={CCR.Example3} />
</div>

‚ö†Ô∏è In the above scenarios, the relationship is correctly announced by NVDA, passes accessibility checks on Axe, WAVE and NVDA but partially fails on Siteimprove and Accessibility Insights tools.

### III. Referencing From the ShadowDOM into the Light DOM

<p>
  <b>‚Ä¢ Shadow DOM ‚Üí Light DOM (or Shadow DOM ‚Üí Slotted Content)</b>‚ùå
</p>

<p>
  A `for` attribute on an element inside a Shadow DOM{' '}
  <b>cannot reference the id of an element outside that Shadow DOM</b>. The `ariaLabelledByElements`
  property neither works in this case because, for it to work, the label element must be in the same
  DOM or in a parent DOM of the target element.
</p>

<Source language="html" dark code={NonWorkingExampleIII}></Source>

##### Working Solution: Set the `id`on the label component host

<p>
  The only option here is to <b>set the `id` directly on the host</b> of the labeling component. In
  this case{' '}
  <b>
    all the visible text inside the referencing component will be assigned as the Accessible Name
  </b>{' '}
  of the target element.
</p>
<Source language="html" dark code={WorkingExampleIII}></Source>
<Canvas of={CCR.Example4} sourceState="hide" />

### IV. Referencing From One Shadow DOM To Another Shadow DOM

Shadow DOM ‚Üí Other Shadow DOM ‚ùå

<Source language="html" dark code={NonWorkingExampleIV}></Source>
<p>
  This relationship is not valid because both `for` and `id` attributes are scoped only within their
  individual shadowDoms.
</p>
##### Working Solution

A working solution for this case combines approaches II and III: setting the label component‚Äôs `id` directly on the host element (III), and using `Element.ariaLabelledByElements` to assign the label to the target component (II).

<Source language="html" dark code={WorkingExampleIV}></Source>
<Canvas of={CCR.Example5} sourceState="hide" />

‚ö†Ô∏è In the above scenario, the relationship is correctly announced by NVDA, passes accessibility checks on Axe, WAVE and NVDA but partially fails on Siteimprove and Accessibility Insights tools.
