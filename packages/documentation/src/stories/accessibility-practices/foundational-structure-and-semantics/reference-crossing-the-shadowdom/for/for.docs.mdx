import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as CCR from './for.stories';

<Meta of={CCR} />

# for

##

<div className="lead">The native HTML `for`/`id` relationship is a fundamental way to connect a `<label>` element to a form control, such as `<input>`, `<select>`, `<textarea>`, etc. or even to a custom form-associated control within the same DOM.</div>

<div>This connection is established by setting the for attribute on the `<label>` to match the `id` attribute of the form control it describes. This relationship is crucial for accessibility, as it allows assistive technologies like screen readers to correctly associate and announce the label text when focus is placed on the associated input field.</div>

### I. Referencing Within the Same DOM Tree ✔️

<Canvas of={CCR.ExampleHTML} sourceState="shown" />

### II. Referencing From Outside a Shadow DOM Into That Shadow DOM ❌

<ul>
  <li>Light DOM → Shadow DOM</li>
  <li>Slotted Content → Shadow DOM</li>
</ul>

<p>When the referencing element (e.g. `<label for="...">`) is in the Light DOM and the target element is inside a Shadow DOM, the `for` attribute <b>cannot reference elements inside the Shadow DOM</b> using the standard id mechanism.</p>

##### Possible Workarounds

###### `Element:ariaLabelledByElements`

Defines programmatically the `ariaLabelledByElements` property of the element: `this.internalEl.ariaLabelledByElements = [labelEl]`. This solution creates the relationship without the use of an `id`.

<b>Light DOM → Shadow DOM Example</b>
<Canvas of={CCR.Example2} sourceState="shown" />
<div className="hide-col-default">
  <Controls of={CCR.Example2} />
</div>

<b>Slotted Content → Shadow DOM Example</b>
<Canvas of={CCR.Example3} sourceState="shown" />
<div className="hide-col-default">
  <Controls of={CCR.Example3} />
</div>

⚠️ In the above scenarios, the relationship is correctly announced by NVDA, passes accessibility checks on Axe, WAVE and NVDA but fails on Siteimprove and Accessibility Insights tools.

### III. Referencing From Inside a Shadow DOM Out to the Light DOM ❌

<ul>
  <li>Shadow DOM → Light DOM</li>
  <li>Shadow DOM → Slotted Content</li>
</ul>
<p>
  A `for` attribute on an element inside a Shadow DOM{' '}
  <b>cannot be used to reference the id of an element outside that Shadow DOM</b> (in the Light DOM
  or an ancestor Shadow DOM). The way the HTML for attribute resolves an id is strictly limited to
  the element's shadow-including tree.
</p>

##### Possible Workaround

A possible workaround is to set directly an `id` on the host of the referencing element and an `aria-labelledby`on the target element.

<Canvas of={CCR.Example4} sourceState="shown" />

### IV.Referencing From a Shadow DOM Out to another Shadow DOM ❌

<ul>
  <li>Shadow DOM → Other Shadow DOM</li>
</ul>

##### Possible Workaround

A workaround for this case combines approaches II and III: using `Element.ariaLabelledByElements` to set an `aria-labelledby` attribute on the Shadow DOM `input`, linking it to an ID defined on the host element of the `label` component.

<Canvas of={CCR.Example5} sourceState="shown" />
<div className="hide-col-default">
  <Controls of={CCR.Example5} />
</div>

⚠️ In the above scenario, the relationship is correctly announced by NVDA, passes accessibility checks on Axe, WAVE and NVDA but fails on Siteimprove and Accessibility Insights tools.
