import { Meta, Source } from '@storybook/blocks';
import { PostTabHeader, PostTabPanel, PostTabs } from '@swisspost/design-system-components-react';
import SampleFrameworks from './internet-header-frameworks.sample.html?raw';
import SampleLazyLoaded from './internet-header-lazy-loaded.sample.js?raw';
import SampleBareComponent from './internet-header-bare-component.sample.js?raw';
import SampleCDNLazyLoaded from './internet-header-cdn-lazy-loaded.sample.html?raw';
import SampleCDNBareComponent from './internet-header-cdn-bare-component.sample.html?raw';
import SampleReference from './internet-header-reference.sample.ts?raw';
import SampleInstall from './internet-header-install.sample.html?raw';
import SampleFixAppStyles from './internet-header-fix-app-styles.sample.html?raw';
import SampleOld from './internet-header-old.sample.html?raw';
import * as PackageStories from './internet-header.stories';
import { SourceDarkScheme } from '@/../.storybook/preview';
import changelog from '@/../../internet-header/CHANGELOG.md?raw';
import PackageDocs from '@/shared/packages-docs-layout.mdx';

<Meta of={PackageStories} />

# @swisspost/internet-header

[![npm version](https://badge.fury.io/js/@swisspost%2Finternet-header.svg)](https://badge.fury.io/js/@swisspost%2Finternet-header)

<div className='lead'>
  The header for client-facing applications.
</div>

<PackageDocs changelog={changelog}>
  <div className="card my-40">
    <div className="card-body">
      <h5 className="card-title">Request a configuration</h5>

      <p className="card-text">The Internet Header is built to support the already existing Portal Configuration used for the old Internet Header.
      <br/>If you're working on a new project, you probably need a new configuration. Please contact the Post Portal Team.</p>

      <h6>Step 1</h6>
      <p className="fs-regular">Integration of header only: contact  <a href="mailto:dm-tec@post.ch" rel="noopener">dm-tec@post.ch <post-icon name="1001" className="fs-large" /></a> directly</p>
      <p className="fs-regular">Integration of header and KLP: contact KLP first for integration</p>

      <h6>Step 2</h6>
      <p className="fs-regular">Provide these informations to DM Tec:</p>
      <ul className="fs-regular">
        <li>ServiceID (ProjektID)</li>
        <li>Languages which you'd like to support</li>
        <li>Allowed referrers per environment (test/int/prod)</li>
        <li>Categories for the Online Service (see <a href="https://www.post.ch/de/kundencenter/onlinedienste#t=AllOSTab&sort=%40servicez32xname%20ascending" rel="noopener">https://www.post.ch/de/kundencenter/onlinedienste#t=AllOSTab&sort=%40servicez32xname%20ascending</a> for a list)</li>
        <li>Name of the Online Service in all available languages</li>
        <li>URLs of all environments and languages (links should be dependent on language)</li>
        <li>Abstract in all available languages (will be shown on <a href="https://www.post.ch/de/kundencenter/onlinedienste#t=AllOSTab&sort=%40servicez32xname%20ascending" rel="noopener">https://www.post.ch/de/kundencenter/onlinedienste#t=AllOSTab&sort=%40servicez32xname%20ascending</a>)</li>
      </ul>

      <div className="banner banner-info banner-md mt-24">
        <p>Not every Online Service has configurations for all environments.
  For example, "TOPOS" only has `int02` configured and cannot use `int01` as value for environment.
  If you are not sure what's configured for your project, please reach out to the post-portal team as well.</p>
      </div>
    </div>
  </div>

  ## Installation

  ### Choose between lazy-loaded or bare component version

  Internet-header package provide two versions:

  - Lazy-loaded (default): it allows better performance by dynamically load the component when used, so it reduces bundle size, startup time and first paint.
  - Bare component: if you already manage the lazy-loading or don't need it for any reason, you can use the component without any overhead.

  <PostTabs>
    <PostTabHeader panel="with-bundler">Install with a bundler</PostTabHeader>
    <PostTabPanel name="with-bundler">
      All the popular frameworks come with some form of bundler.
      This makes it easy to use npm packages like the Internet Header as you can import,
      bundle and deliver the header with your own code.

      When working with Angular or any other framework, the easiest installation method is via npm.

      <Source code={`npm install @swisspost/internet-header`} dark={SourceDarkScheme} language="bash" />

      <Source code={SampleFrameworks} dark={SourceDarkScheme} language="html" />

      <div>
        <div className="row mb-8">
          <div className="col-6 fw-bold">Lazy-Loaded</div>
          <div className="col-6 fw-bold">Bare Component</div>
        </div>
        <div className="row">
          <div className="col-6"><Source code={SampleLazyLoaded} dark={SourceDarkScheme} language="javascript" /></div>
          <div className="col-6"><Source code={SampleBareComponent} dark={SourceDarkScheme} language="javascript" /></div>
        </div>
      </div>
    </PostTabPanel>

    <PostTabHeader panel="with-cdn">Include from a CDN</PostTabHeader>
    <PostTabPanel name="with-cdn">
      If you are not using any bundler or don't want to install from npm, you can load the `internet-header` from your favourite [CDN](https://en.wikipedia.org/wiki/Content_delivery_network).<br/>
      Make sure to replace `{version}` with the version you want to use or remove `@{version}` to use the latest version.

      Available CDNs:

      - [jsDelivr](https://www.jsdelivr.com/): replace `{cdnURL}` with [https://cdn.jsdelivr.net/npm/@swisspost/internet-header](https://cdn.jsdelivr.net/npm/@swisspost/internet-header).
      - [unpkg](https://unpkg.com/): replace `{cdnURL}` with [https://unpkg.com/@swisspost/internet-header](https://unpkg.com/@swisspost/internet-header).

      <div>
        <div className="row mb-8">
          <div className="col-6 fw-bold">Lazy-Loaded</div>
          <div className="col-6 fw-bold">Bare Component</div>
        </div>
        <div className="row">
          <div className="col-6"><Source code={SampleCDNLazyLoaded} dark={SourceDarkScheme} language="html" /></div>
          <div className="col-6"><Source code={SampleCDNBareComponent} dark={SourceDarkScheme} language="html" /></div>
        </div>
      </div>
    </PostTabPanel>
  </PostTabs>

  ### Usage with Angular

  For Angular user, please have a look at [How to integrate Web Components inside Angular](/?path=/docs/8426deb2-3d6d-4fcc-90e6-1ca9737b2ed0--docs#usage-of-web-components)

  ## CSS Variables

  The internet header package provides a stylesheet aimed at facilitating the use of key CSS variables beyond the header itself.
  This stylesheet allows you to access CSS variables to implement styling relative to the header as needed, but it is completely optional.

  <PostTabs>
    <PostTabHeader panel="sass-import">Sass Import</PostTabHeader>
    <PostTabPanel name="sass-import">
      <Source code={`@use "@swisspost/internet-header/dist/swisspost-internet-header/swisspost-internet-header.css";`} dark={SourceDarkScheme} language="scss" />
    </PostTabPanel>
    <PostTabHeader panel="html-import">HTML Import</PostTabHeader>
    <PostTabPanel name="html-import">
      <Source code={`<link rel="stylesheet" href="@swisspost/internet-header/dist/swisspost-internet-header/swisspost-internet-header.css"/>`} dark={SourceDarkScheme} language="html" />
    </PostTabPanel>
  </PostTabs>

  ## Migration from the old header

  This guide aims to give a broad overview of how a migration can be performed.
  Different projects have different levels of integration with the header,
  and therefore require more steps to migrate.

  ### Architecture

  The "new"
  Internet Header Web Component aims
  to encapsulate as much as possible whereas the old header had a big influence on the page â€”
  limiting design decisions and flexibility of the markup structure.
  The Web Component Header consists of one script and three standard Web Components that can be freely placed on the page.
  It's even possible to render those elements with Angular
  (or any other framework) to easier pass settings into the component.

  The new header is built
  to work with the existing Sitecore configuration
  already existing for your project to make the migration as smooth as possible.

  ### Support

  If you need support during your migration,
  don't hesitate
  to contact the [Design System Team](https://github.com/swisspost/design-system/discussions/categories/general) on GitHub.

  ### 1. Remove the old header

  In your index.html, you should find three scripts associated with the old header.
  One to load static assets, one to configure it and one to load it.

  - You can remove the configuration and the loader scripts, but remember your `serviceid`.
  - Try to remove the `staticassets` script to check if you still need it

  <Source code={SampleOld} dark={true} language="html" />

  ### 2. Fix your app styles

  The old header was responsible for wrapping your main code (here `#os_content`) with custom `<div>`s.
  The new header does not provide those wrappers.
  Instead, every page has control over the main markup structure.
  A possible replacement of the above code could be:

  <Source code={SampleFixAppStyles} dark={true} language="html" />

  - Likely you'll need the class `container` around your main content to align it properly in the center.
  - For bonus points on semantic markup, use the [`<main>` tag](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/main) around the main page content
  - Check if you need the `staticasset` stylesheets linked in the header

  If you need to do any other changes,
  please make a post to the [Design System Teams Channel](https://teams.microsoft.com/l/channel/19%3ae7fa68fb13eb40b4bf4604edea5f4b3e%40thread.tacv2/%25F0%259F%259A%2591%2520Support?groupId=123c7c9e-052a-40e6-98d3-6cc6d46bad0a&tenantId=3ae7c479-0cf1-47f4-8f84-929f364eff67)
  in order to inform the devs to update this guide and provide useful information for other developers.

  ### 3. jQuery

  The new Header does not ship jQuery anymore.
  While jQuery v3.6 is an internal dependency for the Login Widget,
  every project is now responsible for loading and updating jQuery individually.
  If you are depending on an older (&lt;3.5) version of jQuery, please update.
  There is a long list of [known jQuery vulnerabilities](https://security.snyk.io/package/npm/jquery).

  ### 4. Install the new header

  Please refer to the [Internet Header installation instructions](/?path=/docs/9b02bcb2-3b6a-4271-b550-675a62ff3890--docs) for an installation guide.

  After installation, you're ready to add the new tags to your markup:

  <Source code={SampleInstall} dark={SourceDarkScheme} language="html" />

  Place the new elements as described (and needed) as shown above.
  The breadcrumbs need a `container` wrapper to align themselves with the content of your page,
  the header and the footer already provide a container.
  If you don't have breadcrumbs, you can just delete the `<aside>` and the `<swisspost-internet-breadcrumbs>`.

  ### 5. Working with the new header

  If you need to change settings during runtime, you can get a reference to the header by querying:

  <Source code={SampleReference} dark={SourceDarkScheme} language="typescript" />

  At the [Internet Header configuration page](/?path=/docs/ebb11274-091b-4cb7-9a3f-3e0451c9a865--docs) you can find a list of possible options.
</PackageDocs>
